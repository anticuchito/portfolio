---
import "../styles/global.css";

export interface Props {
    title: string;
    description?: string;
}

const { title, description = "Portfolio - Desarrollador" } = Astro.props;
---

<!doctype html>
<html lang="es">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>{title}</title>
        <meta name="description" content={description} />
        <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
        <script is:inline>
            // Script para evitar flash de tema incorrecto
            // Primero revisa localStorage, si no existe usa preferencia del sistema
            const savedTheme = localStorage.getItem("theme");
            const systemPrefersDark = window.matchMedia(
                "(prefers-color-scheme: dark)",
            ).matches;

            if (savedTheme === "dark" || (!savedTheme && systemPrefersDark)) {
                document.documentElement.classList.add("dark");
            }
        </script>
    </head>
    <body class="bg-primary text-primary min-h-screen">
        <div class="max-w-6xl mx-auto p-6 md:p-8">
            <!-- Header con navegación -->
            <header
                class="mb-12 flex flex-col md:flex-row justify-between items-start md:items-center gap-4"
            >
                <a
                    href="/"
                    class="text-2xl md:text-3xl font-bold no-underline text-primary hover:text-accent transition-colors"
                >
                    TU_NOMBRE
                </a>

                <nav class="flex flex-wrap items-center gap-4 md:gap-6">
                    <a href="/" class="text-sm md:text-base font-bold">INICIO</a
                    >
                    <a href="/about" class="text-sm md:text-base font-bold"
                        >ABOUT</a
                    >

                    <a
                        href="/experiencia"
                        class="text-sm md:text-base font-bold">EXPERIENCIA</a
                    >
                    <a href="/proyectos" class="text-sm md:text-base font-bold"
                        >PROYECTOS</a
                    >
                    <a href="/contacto" class="text-sm md:text-base font-bold"
                        >CONTACTO</a
                    >

                    <!-- Toggle modo oscuro -->
                    <button
                        id="theme-toggle"
                        class="btn-brutal text-sm py-2 px-4"
                        aria-label="Cambiar tema"
                    >
                        <span id="theme-icon">◐</span>
                    </button>
                </nav>
            </header>

            <!-- Contenido principal -->
            <main>
                <slot />
            </main>

            <!-- Footer simple -->
            <footer
                class="mt-16 pt-8 border-t-4 border-brutal text-center text-secondary text-sm"
            >
                <p>
                    © {new Date().getFullYear()} - Construido con Astro + Tailwind
                </p>
            </footer>
        </div>

        <script>
            // Lógica del toggle de tema con soporte para preferencia del sistema
            const themeToggle = document.getElementById("theme-toggle");
            const themeIcon = document.getElementById("theme-icon");
            const html = document.documentElement;

            function updateThemeIcon() {
                if (html.classList.contains("dark")) {
                    themeIcon.textContent = "☀";
                } else {
                    themeIcon.textContent = "◐";
                }
            }

            // Toggle manual - guarda preferencia en localStorage
            themeToggle?.addEventListener("click", () => {
                html.classList.toggle("dark");
                const isDark = html.classList.contains("dark");
                localStorage.setItem("theme", isDark ? "dark" : "light");
                updateThemeIcon();
            });

            // Escuchar cambios en la preferencia del sistema
            window
                .matchMedia("(prefers-color-scheme: dark)")
                .addEventListener("change", (e) => {
                    // Solo cambia si el usuario no ha establecido una preferencia manual
                    if (!localStorage.getItem("theme")) {
                        if (e.matches) {
                            html.classList.add("dark");
                        } else {
                            html.classList.remove("dark");
                        }
                        updateThemeIcon();
                    }
                });

            updateThemeIcon();
        </script>
    </body>
</html>
