---
import "../styles/global.css";
import { basics, projects } from "../lib/data";

const onlyName = basics.name.split(" ")[0];
const hasProjects = projects && projects.length > 0;

export interface Props {
    title: string;
    description?: string;
}

const { title, description = "Portfolio - Desarrollador" } = Astro.props;
const currentPath = Astro.url.pathname;
console.log("Current path:", currentPath);
---

<!doctype html>
<html lang="es">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>{title}</title>
        <meta name="description" content={description} />
        <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
        <script is:inline>
            // Script para evitar flash de tema incorrecto
            // Primero revisa localStorage, si no existe usa preferencia del sistema
            const savedTheme = localStorage.getItem("theme");
            const systemPrefersDark = window.matchMedia(
                "(prefers-color-scheme: dark)",
            ).matches;

            if (savedTheme === "dark" || (!savedTheme && systemPrefersDark)) {
                document.documentElement.classList.add("dark");
            }
        </script>
    </head>
    <body class="bg-primary text-primary min-h-screen">
        <!-- Skip link para accesibilidad -->
        <a
            href="#main-content"
            class="sr-only focus:not-sr-only focus:absolute focus:top-4 focus:left-4 focus:z-50 focus:px-4 focus:py-2 focus:bg-accent focus:text-white focus:font-bold"
        >
            Saltar al contenido principal
        </a>

        <div class="max-w-6xl mx-auto p-6 md:p-8">
            <!-- Header con navegación -->
            <header class="mb-12">
                <div class="flex justify-between items-center">
                    <!-- Logo -->
                    <a
                        href="/"
                        class="flex items-center gap-2 text-2xl md:text-3xl font-bold no-underline text-primary hover:text-accent transition-colors"
                        aria-label="Ir al inicio"
                    >
                        <span class="text-accent">&lt;/&gt;</span>
                    </a>

                    <!-- Menú desktop -->
                    <nav class="hidden md:flex items-center gap-6">
                        <a
                            href="/"
                            class={`text-sm font-bold focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-accent focus-visible:ring-offset-2 rounded py-1 ${currentPath === "/" ? "text-accent border-b-2 border-accent" : ""}`}
                            >INICIO</a
                        >
                        <a
                            href="/about"
                            class={`text-sm font-bold focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-accent focus-visible:ring-offset-2 rounded py-1 ${currentPath === "/about" ? "text-accent border-b-2 border-accent" : ""}`}
                            >ABOUT</a
                        >
                        <a
                            href="/experiencia"
                            class={`text-sm font-bold focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-accent focus-visible:ring-offset-2 rounded py-1 ${currentPath === "/experiencia" ? "text-accent border-b-2 border-accent" : ""}`}
                            >EXPERIENCIA</a
                        >
                        {hasProjects && (
                            <a
                                href="/proyectos"
                                class={`text-sm font-bold focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-accent focus-visible:ring-offset-2 rounded py-1 ${currentPath === "/proyectos" ? "text-accent border-b-2 border-accent" : ""}`}
                                >PROYECTOS</a
                            >
                        )}
                        <a
                            href="/contacto"
                            class={`text-sm font-bold focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-accent focus-visible:ring-offset-2 rounded py-1 ${currentPath === "/contacto" ? "text-accent border-b-2 border-accent" : ""}`}
                            >CONTACTO</a
                        >

                        <!-- Toggle modo oscuro -->
                        <button
                            id="theme-toggle"
                            class="btn-brutal text-sm py-2 px-4"
                            aria-label="Cambiar tema"
                        >
                            <span id="theme-icon">◐</span>
                        </button>
                    </nav>

                    <!-- Botón menú móvil -->
                    <button
                        id="mobile-menu-btn"
                        class="md:hidden btn-brutal py-2 px-3"
                        aria-label="Abrir menú"
                        aria-expanded="false"
                        aria-controls="mobile-menu"
                    >
                        <span id="menu-icon">☰</span>
                    </button>
                </div>

                <!-- Menú móvil -->
                <nav
                    id="mobile-menu"
                    class="hidden md:hidden mt-4 pt-4 border-t-4 border-brutal"
                    aria-label="Navegación móvil"
                >
                    <div class="flex flex-col gap-3">
                        <a
                            href="/"
                            class={`text-base font-bold py-2 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-accent focus-visible:ring-offset-2 rounded ${currentPath === "/" ? "text-accent border-l-4 border-accent pl-3" : "pl-4"}`}
                            >INICIO</a
                        >
                        <a
                            href="/about"
                            class={`text-base font-bold py-2 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-accent focus-visible:ring-offset-2 rounded ${currentPath === "/about" ? "text-accent border-l-4 border-accent pl-3" : "pl-4"}`}
                            >ABOUT</a
                        >
                        <a
                            href="/experiencia"
                            class={`text-base font-bold py-2 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-accent focus-visible:ring-offset-2 rounded ${currentPath === "/experiencia" ? "text-accent border-l-4 border-accent pl-3" : "pl-4"}`}
                            >EXPERIENCIA</a
                        >
                        {hasProjects && (
                            <a
                                href="/proyectos"
                                class={`text-base font-bold py-2 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-accent focus-visible:ring-offset-2 rounded ${currentPath === "/proyectos" ? "text-accent border-l-4 border-accent pl-3" : "pl-4"}`}
                                >PROYECTOS</a
                            >
                        )}
                        <a
                            href="/contacto"
                            class={`text-base font-bold py-2 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-accent focus-visible:ring-offset-2 rounded ${currentPath === "/contacto" ? "text-accent border-l-4 border-accent pl-3" : "pl-4"}`}
                            >CONTACTO</a
                        >

                        <!-- Toggle modo oscuro móvil -->
                        <button
                            id="theme-toggle-mobile"
                            class="btn-brutal text-sm py-2 px-4 mt-2 w-fit"
                            aria-label="Cambiar tema"
                        >
                            <span id="theme-icon-mobile">◐</span> Cambiar tema
                        </button>
                    </div>
                </nav>
            </header>

            <!-- Contenido principal -->
            <main id="main-content">
                <slot />
            </main>

            <!-- Footer simple -->
            <footer
                class="mt-16 pt-8 border-t-4 border-brutal text-center text-secondary text-sm"
            >
                <p>
                    © {new Date().getFullYear()} - Construido con Astro + Tailwind
                </p>
            </footer>
        </div>

        <script>
            // Lógica del toggle de tema con soporte para preferencia del sistema
            const themeToggle = document.getElementById("theme-toggle");
            const themeToggleMobile = document.getElementById(
                "theme-toggle-mobile",
            );
            const themeIcon = document.getElementById("theme-icon");
            const themeIconMobile =
                document.getElementById("theme-icon-mobile");
            const html = document.documentElement;

            function updateThemeIcon() {
                if (themeIcon) {
                    themeIcon.textContent = html.classList.contains("dark")
                        ? "☀"
                        : "◐";
                }
                if (themeIconMobile) {
                    themeIconMobile.textContent = html.classList.contains(
                        "dark",
                    )
                        ? "☀"
                        : "◐";
                }
            }

            function toggleTheme() {
                html.classList.toggle("dark");
                const isDark = html.classList.contains("dark");
                localStorage.setItem("theme", isDark ? "dark" : "light");
                updateThemeIcon();
            }

            // Toggle manual desktop
            themeToggle?.addEventListener("click", toggleTheme);

            // Toggle manual móvil
            themeToggleMobile?.addEventListener("click", toggleTheme);

            // Escuchar cambios en la preferencia del sistema
            window
                .matchMedia("(prefers-color-scheme: dark)")
                .addEventListener("change", (e) => {
                    if (!localStorage.getItem("theme")) {
                        if (e.matches) {
                            html.classList.add("dark");
                        } else {
                            html.classList.remove("dark");
                        }
                        updateThemeIcon();
                    }
                });

            updateThemeIcon();

            // Menú móvil
            const mobileMenuBtn = document.getElementById("mobile-menu-btn");
            const mobileMenu = document.getElementById("mobile-menu");
            const menuIcon = document.getElementById("menu-icon");

            mobileMenuBtn?.addEventListener("click", () => {
                const isExpanded =
                    mobileMenuBtn.getAttribute("aria-expanded") === "true";
                mobileMenuBtn.setAttribute(
                    "aria-expanded",
                    String(!isExpanded),
                );
                mobileMenu?.classList.toggle("hidden");
                if (menuIcon) {
                    menuIcon.textContent = isExpanded ? "☰" : "✕";
                }
            });

            // Cerrar menú al hacer click en un link
            mobileMenu?.querySelectorAll("a").forEach((link) => {
                link.addEventListener("click", () => {
                    mobileMenu.classList.add("hidden");
                    mobileMenuBtn?.setAttribute("aria-expanded", "false");
                    if (menuIcon) {
                        menuIcon.textContent = "☰";
                    }
                });
            });
        </script>
    </body>
</html>
